Welcome Back.

This lecture will teach us to create a build pipeline using Azure DevOps.

So, let's start.

A build pipeline often requires creating a YAML file.

The YAML file defines all the steps for the build pipeline and may contain code and scripts.

So, the first step for creating a build pipeline is to create a YAML file.

Let's start from this step.

Login to your Azure DevOps portal.

Go to your SBIT project.

Go to the Repos.

We want to create a YAML file for our build pipeline that works on all the branches.

So, let me create a new branch.

Click the branch name at the top of the page and hit the new branch button.

Give a name to your feature branch.

Let's make it based on the release branch.

Hit the create button.

Done.

Hit the three dots next to the SBT project name and create a new file.

Give a name to your file.

Hit the create button.

Now, let me paste the YAML file content.

Great!

So this is a small YAML file for a super simple build pipeline.

Let me quickly explain the YAML file.

The topmost line defines the trigger.

The batch is set to true.

If multiple people commit simultaneously,

we will trigger only one build, and the others will wait until the previous one is complete.

Then, we define the branches with a star.

That means this pipeline runs on all branches.

The following configuration is for the agent virtual machine.

I wanted to use ubuntu-22.04 because my Databricks environment also uses ubuntu-22.04 VMs.

Matching the agent VM with your Databricks VM is essential to avoid unnecessary conflicts.

Finally, we define the build pipeline steps.

The first step is an Azure DevOps in-built task to install Python on the Agent machine.

And I want the Python 3.10.

Why?

Because my Databricks Runtime is also using Python 3.10.

You should also match the Python version.

The next step is an inline script.

We use the pip install command to install tools such as pytest, requests, setup tools, and wheel.

I am not planning to use these tools in my build pipeline,

but I kept this step to show you how to install Python tools on your agent.

The next step in the pipeline is to check out the latest code.

We again run an inline script in the next step.

This step is to copy the latest code to a binaries directory.

We will be using the binaries directory to prepare the artifact.

The last step in my pipeline is again an Azure DevOps in-built task for archiving the files.

In this step, we will read the files from the binaries directory and create a zip file compressing everything.

Save the zip file into the Artifact Staging Directory.

And that is all.

So this super simple build pipeline pulls the code from the repository,

assumes only notebook code is there, creates a zip of all your notebooks, and publishes the zip file to the artifact.

We are not running any PyTest unit test cases in this example.

Why?

Because we do not have any unit test cases written for our project.

We only implemented an integration test.

So we are skipping it.

But if you have Pytest unit test cases, you can add one more step for unit testing.

Adding a unit testing step is as simple as adding one more inline script

similar to the pip or cp command shown in your YAML file.

We wanted to keep it simple, so we skipped PyTest steps.

Great!

So, you finished creating your YAML file.

Hit the commit button.

The branch name is feature-build.

Click commit.

Done.

We created our YAML file.

We need this file in all of our branches.

So, let me create a pull request to merge this file into the release branch.

The source branch is feature-build;

the target should be the release branch.

Give a title.

Come down and hit the create button.

Now click the complete button.

Hit the complete merge once again.

That's all.

The merge will be complete in a few minutes.

The next step is to create the build pipeline.

Do you see the pipelines in the menu?

Click the Pipelines and choose Pipelines.

Hit the new pipeline button.

Choose your source code repository.

We are using Azure repos.

So choose the first one.

Now select your project.

We have already created the YAML file.

So choose the "Existing Azure Pipelines YAML file.

Select the release branch.

Now select your YAML file.

That's all.

Click the continue button.

Now, you can click the down arrow button next to the run and hit the save button.

That's all.

Your pipeline is now ready.

Let's not run it.

It should automatically run when we commit to the release branch or create a pull request for the release branch.

We will do that in the following lecture and see it in action.

But before that, we also want to create a release pipeline.

I will show you the release pipeline in the following lecture.

See you again.

Keep Learning and Keep Growing.
